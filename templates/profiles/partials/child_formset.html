{% load i18n %}
<form hx-post="{{ update_url }}" hx-swap="outerHTML" hx-target="this">
  {{ formset.management_form }}
  {% for form in formset %}
    {% if form.instance.id %}
      <div hx-post="{{ update_url }}"
           hx-swap="outerHTML"
           hx-target="closest form"
           hx-trigger="change">
        {% for field in form %}
          <div class="mt-4 relative"
               x-data="{ active: false }"
               @mouseenter="active = true"
               @mouseleave="active = false">
            {% if field.widget_type == "text" %}
              <label for="{{ field.id_for_label }}"
                     class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-400">
                {{ field.label }}
              </label>
            {% endif %}
            {{ field }}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div x-data="{ open: false }"
           x-on:mouseenter="open = true"
           x-on:mouseleave="open = false">
        <button x-show="!open" type="button" x-on:click="open = true">{% trans "New" %}</button>
        <div x-show="open"  x-transition>
          {% for field in form %}
            <div class="mt-4 relative"
                 x-data="{ active: false }"
                 @mouseenter="active = true"
                 @mouseleave="active = false">
              {% if field.widget_type == "text" %}
                <label for="{{ field.id_for_label }}"
                       class="absolute -top-2 left-2 inline-block bg-white px-1 text-xs font-medium text-gray-400">
                  {{ field.label }}
                </label>
              {% endif %}
              {{ field }}
            </div>
          {% endfor %}
          <button type="submit">Add</button>
        </div>
      </div>
    {% endif %}
  {% endfor %}
</form>
